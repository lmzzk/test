function countDown(e) {
    function t() {
        count--, e.text("重新发送(" + count + ")");
        var s = setTimeout(function () {
            t()
        }, 1e3);
        count <= 0 && (e.text("获取验证码"), clearTimeout(s), e.removeAttr("disabled"))
    }

    count = 60, e.attr("disabled", "disabled"), t()
}
function getPublicKey() {
    $.ajax({
        url: baseURL + getPublicKeyUrl,
        type: "GET",
        headers: handleSign({
            method: "GET",
            rawData: {},
            sysCode: "crisps-crm",
            secret: "ea052a6c8162443b6f8ac673f32e8376",
            token:Math.floor(Math.random()*new Date())+'mD21dsRf10ND25g'+Math.floor(Math.random()*new Date())
        }),
        dataType: "json",
        async: !1,
        success: function (e) {
            200 == e.code ? publicKeyRes = e.data : layer.msg(e.message)
        },
        error: function (e) {
            console.log(e)
        }
    })
}
function doEncrypt(e) {
    getPublicKey();
    var t = new JSEncrypt;
    return t.setPublicKey(publicKeyRes), t.encrypt(e)
}
function getCodeApi(e, t) {
    var s = handleSign({method: "POST", sysCode: "crisps-crm", secret: "ea052a6c8162443b6f8ac673f32e8376", rawData: e,token:Math.floor(Math.random()*new Date())+'mD21dsRf10ND25g'+Math.floor(Math.random()*new Date())});
    s["content-type"] = "application/json;charset=UTF-8", $.ajax({
        url: baseURL + getPhoneCodeUrl,
        type: "POST",
        headers: s,
        dataType: "json",
        data: JSON.stringify(e),
        async: !1,
        success: function (e) {
            200 == e.code ? (countDown(t), layer.msg("获取成功")) : layer.msg(e.message)
        },
        error: function (e) {
            console.log(e)
        }
    })
}
function consultFormApi(e) {
    var t = "", s = handleSign({
        method: "POST",
        sysCode: "crisps-crm",
        secret: "ea052a6c8162443b6f8ac673f32e8376",
        rawData: e,
        token:Math.floor(Math.random()*new Date())+'mD21dsRf10ND25g'+Math.floor(Math.random()*new Date())
    });
    return s["content-type"] = "application/json;charset=UTF-8", $.ajax({
        url: baseURL + consultFormUrl,
        type: "POST",
        headers: s,
        dataType: "json",
        data: JSON.stringify(e),
        async: !1,
        success: function (e) {
            200 == e.code ? (layer.msg(e.message), t = 200) : layer.msg(e.message)
        },
        error: function (e) {
            console.log(e)
        }
    }), t
}
function secondaryFormApi(e) {
    var t = "", s = handleSign({
        method: "POST",
        sysCode: "crisps-crm",
        secret: "ea052a6c8162443b6f8ac673f32e8376",
        rawData: e,
        token:Math.floor(Math.random()*new Date())+'mD21dsRf10ND25g'+Math.floor(Math.random()*new Date())
    });
    return s["content-type"] = "application/json;charset=UTF-8", $.ajax({
        url: baseURL + secondaryFormUrl,
        type: "POST",
        contentType: "application/json;charset=UTF-8",
        headers: s,
        dataType: "json",
        data: JSON.stringify(e),
        async: !1,
        success: function (e) {
            200 == e.code ? (layer.msg(e.message), t = 200) : layer.msg(e.message)
        },
        error: function (e) {
            console.log(e)
        }
    }), t
}
function getDate() {
    var e = new Date, t = JSON.stringify(e.getFullYear()), s = JSON.stringify(e.getMonth() + 1), n = JSON.stringify(e.getDate()), r = JSON.stringify(e.getHours()), a = JSON.stringify(e.getMinutes()), c = JSON.stringify(e.getSeconds()), o = t + s + n + r + a + c;
    return o
}
document.writeln('<script src="https://tgform.dgg.cn/tools/public/message/layer.js"></script>'), document.writeln('<script src="https://tgform.dgg.cn/form_qds/sign.js"></script>'), document.writeln('<script src="https://tgform.dgg.cn/form_qds/jsencrypt.js"></script>');
var count, baseURL = "https://spmicrouag.shupian.cn/crisps-resource-house-pre", getPublicKeyUrl = "/nk/v1/rsa/get_resource_public_key.do", consultFormUrl = "/nk/v1/consult/data/sms_add_customer_consult.do", getPhoneCodeUrl = "/nk/v1/consult/data/get_mobile_verification_code.do", secondaryFormUrl = "/nk/v1/consult/data/associated_secondary_form_attribute.do", publicKeyRes = "", formId = "", textareaId = "";