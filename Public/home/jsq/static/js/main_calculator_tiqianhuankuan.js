function debj(s,t,e,a){var h,y=0,d=s/e,k=new Object;k.ybj=d;var l=s,n=[];for(i=1;e>=i;i++){h=s/e+(s-s*(i-1)/e)*t,1==i&&(k.syhk=h),2==i&&(k.mydj=k.syhk-h),y+=h,ylx=h-d,l-=d;var r=new Object;r.bh=i,r.ylx=ylx,r.yhk=h,r.ye=l,n[i-1]=r}return 1==a&&(k.xx=n),k.zlx=y-s,k.hkze=y,k}$(function(){$.datepicker.setDefaults({changeMonth:!0,changeYear:!0,showMonthAfterYear:!0}),$("#DataFirstDate").datepicker({numberOfMonths:1,dateFormat:"yy-mm-dd"}),$("#DataFirstDate").datepicker("setDate",new Date),$("#DataWantDate").datepicker({numberOfMonths:1,dateFormat:"yy-mm-dd"}),$("#DataWantDate").datepicker("setDate",new Date);var s=RCal.dkqxOption,t=RCal.lilvOption;obj_dkqx_sel=new Combox("DataYear","yhkqs",s,360,168,29,{listDivId:"dkqx_list_1",onchange:function(){e.cal_lv()}}),obj_dklv_sel=new Combox("DataLilv","dklv_class",t,1,168,29,{listDivId:"dkqx_list_1",onchange:function(){e.cal_lv()}});var e={els:{money:$("#DataMoney"),year:$("input[name=DataYear]"),lilv:$("#dklv"),lilvBs:$("input[name=DataLilv]"),firstDate:$("#DataFirstDate"),wantDate:$("#DataWantDate"),payAll:$("#RadioPayAll"),paySome:$("#RadioPaySome"),someText:$("#DataTextSome"),yearMethod:$("#RadioMethodYear"),wrapMethod:$(".WrapMethod"),monthMethod:$("#RadioMethodMonth"),firstPay:$("#ResultFirstPay"),lastPay:$("#ResultLastPay"),payAll:$("#ResultPayeAll"),payLixi:$("#ResultPayedLivxi"),nowPay:$("#ResultNowPay"),nextPay:$("#ResultNextPay"),saveLixi:$("#ResultSaveLixi"),newPayDate:$("#ResultNewPayDate"),resultTips:$("#ResultTips"),run:$("#Run")},init:function(){var s=this;s.bind(),this.els.run.click(function(){s.doCal(),$(".save-result-btn").show();var t=$(window.opera?"CSS1Compat"==document.compatMode?"html":"body":"html,body");$.browser.webkit&&(t=$("body"));var e=$(".save-result-btn").offset().top;t.animate({scrollTop:e},350)}),$(".recalculate").each(function(){$(this).click(function(){var s=$(window.opera?"CSS1Compat"==document.compatMode?"html":"body":"html,body");$.browser.webkit&&(s=$("body"));var t=$("#content-main").offset().top;s.animate({scrollTop:t},350)})}),$(".r_bj").hide(),$("input[name=hkfs]").change(function(){"0"==$("input[name=hkfs]:checked").val()?($(".r_bj").hide(),$(".r_bx").show()):($(".r_bj").show(),$(".r_bx").hide())}),$(".input-block .yt-list").click(function(){s.cal_lv()}),s.cal_lv()},bind:function(){var s=this;$("#RadioPayAll").click(function(){s.els.wrapMethod.hide()}),this.els.paySome.click(function(){s.els.wrapMethod.show()})},cal_lv:function(){var s=this,t=$("input[name=dklv_class]").val(),e=$("input[name=yhkqs]").val(),a=RCal.getLilv(e,t);s.els.lilv.val(a+"%")},doCal:function(){var s=$("#DataFirstDate").val().split("-"),t=$("#DataWantDate").val().split("-");if(""==document.tqhdjsq.dkzws.value)return alert("请填入贷款总额"),!1;if(dkzys=1e4*parseFloat(document.tqhdjsq.dkzws.value),document.tqhdjsq.tqhkfs[1].checked&&""==document.tqhdjsq.tqhkws.value)return alert("请填入部分提前还款额度"),!1;if(s_yhkqs=parseInt(document.tqhdjsq.yhkqs.value),dklv=parseFloat($("#dklv").val())/12*.01,yhdkqs=12*parseInt(t[0])+parseInt(t[1])-(12*parseInt(s[0])+parseInt(s[1])),0>yhdkqs||yhdkqs>s_yhkqs)return alert("预计提前还款时间与第一次还款时间有矛盾，请查实"),!1;if(remark="",yhkjssj=Math.floor((12*parseInt(s[0])+parseInt(s[1])+s_yhkqs-2)/12)+"年"+((12*parseInt(s[0])+parseInt(s[1])+s_yhkqs-2)%12+1)+"月",y_mydj=0,r_mydj=0,document.tqhdjsq.hkfs[0].checked){for(yhk=dkzys*dklv*Math.pow(1+dklv,s_yhkqs)/(Math.pow(1+dklv,s_yhkqs)-1),yhdkys=yhk*yhdkqs,yhlxs=0,yhbjs=0,a=1;yhdkqs>=a;a++)yhlxs+=(dkzys-yhbjs)*dklv,yhbjs=yhbjs+yhk-(dkzys-yhbjs)*dklv;if(tqhkys=0,document.tqhdjsq.tqhkfs[1].checked)if(tqhkys=1e4*parseInt(document.tqhdjsq.tqhkws.value),tqhkys+yhk>=(dkzys-yhbjs)*(1+dklv))remark="您的提前还款额已足够还清所欠贷款！";else if(yhbjs=yhbjs+yhk-(dkzys-yhbjs)*dklv,byhk=yhk+tqhkys,document.tqhdjsq.clfs[0].checked){for(yhbjs_temp=yhbjs+tqhkys,xdkqs=0;dkzys>=yhbjs_temp;xdkqs++)yhbjs_temp=yhbjs_temp+yhk-(dkzys-yhbjs_temp)*dklv;xdkqs-=1,xyhk=(dkzys-yhbjs-tqhkys)*dklv*Math.pow(1+dklv,xdkqs)/(Math.pow(1+dklv,xdkqs)-1),jslx=yhk*s_yhkqs-yhdkys-byhk-xyhk*xdkqs,xdkjssj=Math.floor((12*parseInt(t[0])+parseInt(t[1])+xdkqs-2)/12)+"年"+((12*parseInt(t[0])+parseInt(t[1])+xdkqs-2)%12+1)+"月"}else xyhk=(dkzys-yhbjs-tqhkys)*dklv*Math.pow(1+dklv,s_yhkqs-yhdkqs-1)/(Math.pow(1+dklv,s_yhkqs-yhdkqs-1)-1),jslx=yhk*s_yhkqs-yhdkys-byhk-xyhk*(s_yhkqs-yhdkqs),xdkjssj=yhkjssj;(document.tqhdjsq.tqhkfs[0].checked||""!=remark)&&(byhk=(dkzys-yhbjs)*(1+dklv),xyhk=0,jslx=yhk*s_yhkqs-yhdkys-byhk,xdkjssj=t[0]+"年"+t[1]+"月")}else{var e=debj(dkzys,dklv,s_yhkqs,1);yhk=e.syhk,yhdkys=0,yhlxs=0;for(var a=0;yhdkqs>a;a++)yhdkys+=e.xx[a].yhk,yhlxs+=e.xx[a].ylx;if(yhbjs=dkzys/s_yhkqs*yhdkqs,document.tqhdjsq.tqhkfs[0].checked)byhk=e.xx[yhdkqs].ye+e.xx[yhdkqs].yhk,xyhk=0,jslx=e.zlx-yhlxs-e.xx[yhdkqs].ylx,xdkjssj=t[0]+"年"+t[1]+"月";else{tqhkys=1e4*parseInt(document.tqhdjsq.tqhkws.value),byhk=e.xx[yhdkqs].yhk+tqhkys;var h=e.xx[yhdkqs].ye-tqhkys;document.tqhdjsq.clfs[0].checked?(xdkqs=parseInt(h/(dkzys/s_yhkqs)),_debjResult=debj(h,dklv,xdkqs,1),xdkjssj=Math.floor((12*parseInt(t[0])+parseInt(t[1])+xdkqs-2)/12)+"年"+((12*parseInt(t[0])+parseInt(t[1])+xdkqs-2)%12+2)+"月"):(_debjResult=debj(h,dklv,s_yhkqs-yhdkqs-1,1),xdkjssj=yhkjssj),xyhk=_debjResult.syhk,jslx=e.zlx-yhlxs-e.xx[yhdkqs].ylx-_debjResult.zlx,r_mydj=Math.round(100*_debjResult.mydj)/100,$("#r_mydj").text(r_mydj)}y_mydj=Math.round(100*e.mydj)/100,$("#y_mydj").text(y_mydj)}var y=Math.round(100*yhk)/100,d=Math.round(100*yhdkys)/100,k=Math.round(100*yhlxs)/100,l=Math.round(100*byhk)/100,n=Math.round(100*xyhk)/100,r=Math.round(100*jslx)/100;return this.els.firstPay.html(y),this.els.payAll.html(d),this.els.payLixi.html(k),this.els.nowPay.html(l),this.els.nextPay.html(n),this.els.saveLixi.html(r),this.els.lastPay.html(yhkjssj),this.els.newPayDate.html(xdkjssj),this.els.resultTips.html(remark),window.CalculatorResult={hkfs:document.tqhdjsq.hkfs[0].checked?1:2,dkzys:document.tqhdjsq.dkzws.value,s_yhkqs:s_yhkqs,dklv:document.tqhdjsq.dklv_class.value,firstDay:$("#DataFirstDate").val(),wantDay:$("#DataWantDate").val(),method:document.tqhdjsq.tqhkfs[0].checked,tqhkys:document.tqhdjsq.tqhkws.value,clfs:document.tqhdjsq.clfs[0].checked,firstPay:y,payAll:d,payLixi:k,nowPay:l,nextPay:n,saveLixi:r,lastPay:yhkjssj,newPayDate:xdkjssj,resultTips:remark,y_mydj:y_mydj,r_mydj:r_mydj},!1},getMonthCount:function(){var s=this.els.firstDate.val().split("-"),t=this.els.wantDate.val().split("-"),e=Number(t[2])>Number(s[2])?!0:!1,a=12*(Number(t[0])-Number(s[0]))+(Number(t[1])-Number(s[1]));return a=e?a:a-1}};e.init()});